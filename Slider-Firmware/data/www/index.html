<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
  <title>Slider Controller</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/chart.js"></script>
</head>

<body class="bg-dark user-select-none">
  <!-- 
    **************************************************************
                       Navigation Bar
    **************************************************************
  -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-darker">
    <div class="container-fluid">
      <a class="navbar-brand text-white-50 " href="#"><img class="header-icon" src="./images/icon-32.png" /> SLIDER
        CONTROLLER</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Control Panel</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Settings</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              Profiles
            </a>
            <ul class="dropdown-menu bg-darker" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item text-light bg-darker" href="#">Profile 1</a></li>
              <li>
                <hr class="dropdown-divider text-light">
              </li>
              <li><a class="dropdown-item text-secondary bg-darker" href="#">Profile 2</a></li>
              <li><a class="dropdown-item text-secondary bg-darker" href="#">Profile 3</a></li>
              <li><a class="dropdown-item text-secondary bg-darker" href="#">Profile 4</a></li>
              <li><a class="dropdown-item text-secondary bg-darker" href="#">Profile 5</a></li>
              <li>
                <hr class="dropdown-divider text-light">
              </li>
              <li><a class="dropdown-item text-primary bg-darker" href="#">... Edit Profiles</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="modal" data-bs-target="#exampleModal" href="#">About</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container content">
    <!-- 
    **************************************************************
                              Content
    **************************************************************
  -->
    <!-- 
    **************************************************************
                              Settings
  -->
    <input id="ip" type="hidden" value="%IP%" />
    <!-- <h6 class="statusBar">
      STATUS:
      <small id="status" class="text-muted">%STATE%</small>
    </h6> -->
    <div class="mode-container">
      <div class="form-check form-switch checkContainer">
        <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
        <label class="form-check-label checkContainerLabel" for="flexSwitchCheckDefault"> SLAVE MODE</label>
      </div>
      <div class="form-check form-switch checkContainer">
        <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault1">
        <label class="form-check-label checkContainerLabel" for="flexSwitchCheckDefault"> TIMELAPSE MODE</label>
      </div>
    </div>
    <p><a href="#"><button class="btn btn-primary">IN</button></a> <a href="#"><button
          class="btn btn-success">OUT</button></a> <a href="#"><button class="btn btn-secondary">+</button></a></p>
    

    <hr>

    <!-- 
    **************************************************************
                              Joystick
  -->
    <div class="control-container">
      <div class="joystick-box">
        <div class="joystick-container">
          <div class="joystick1">
            <img src="images/joystick-base.png" />
            <div id="stick1" class="stick">
              <img src="images/joystick-red.png" />
            </div>
          </div>
          <label class="form-label joystick-label text-secondary">SLIDE / FOCUS</label>
          <div class="form-check form-switch checkContainer">
            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault1" checked>
            <label class="form-check-label checkContainerLabel" for="flexSwitchCheckDefault"> LOCK AXIS</label>
          </div>
        </div>
      </div>
      <div class="joystick-box">
        <div class="joystick-container">
          <div class="joystick2">
            <img src="images/joystick-base.png" />
            <div id="stick2" class="stick">
              <img src="images/joystick-blue.png" />
            </div>
          </div>
          <label class="form-label joystick-label  text-secondary">PAN / TILT</label>
          <div class="form-check form-switch checkContainer">
            <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault1">
            <label class="form-check-label checkContainerLabel" for="flexSwitchCheckDefault"> LOCK AXIS</label>
          </div>
        </div>

      </div>
    </div>
    <hr>
    <!-- 
    **************************************************************
                             Graphs
  -->
    <p class="kinematic-title">KEYFRAME KINEMATIC</p>
    <div class="graph">
      <canvas id="myChart" class="graphChildren"></canvas>
    </div>
    <div class="btn-group" role="group" aria-label="Choose Axis">
      <button type="button" class="btn btn-outline-primary active">Slide</button>
      <button type="button" class="btn btn-outline-primary">Pan</button>
      <button type="button" class="btn btn-outline-primary">Tilt</button>
      <button type="button" class="btn btn-outline-primary">Focus</button>
    </div><br>
    <hr>
    <p class="kinematic-title">KINEMATIC CONTROLS</p>
    <div class="btn-group kinetic-group-button" role="group" aria-label="Axis Kinematic">
      <button type="button" class="btn btn-outline-primary ">Off</button>
      <button type="button" class="btn btn-outline-primary ">Linear</button>
      <button type="button" class="btn btn-outline-primary active">Parabolic</button>
      <button type="button" class="btn btn-outline-primary">Inverse</button>
    </div><br>
    <div class="range-container">
      <label for="customRange1" class="form-label ease-control-label">Ease-in&nbsp;</label>
      <input type="range" class="form-range ease-control" id="ease-in">&nbsp;
      <label for="customRange1" class="form-label ease-control-label">Duration</label>
      <input type="range" class="form-range ease-control" id="ease-in-duration">
    </div>
    <div class="range-container">
      <label for="customRange1" class="form-label ease-control-label">Ease-out</label>
      <input type="range" class="form-range ease-control" id="ease-out">&nbsp;
      <label for="customRange1" class="form-label ease-control-label">Duration</label>
      <input type="range" class="form-range ease-control" id="ease-out-duration">
    </div>



    <!-- 
    **************************************************************
                              Modals
    **************************************************************
  -->
    <!-- 
    **************************************************************
                              About -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content bg-dark">
          <div class="modal-header">
            <h5 class="modal-title text-white-50" id="exampleModalLabel"><img class="header-icon"
                src="./images/icon-32.png" /> About</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="card bg-darker">
              <div class="card-img-top">
                <img src="./images/splash.jpg" class="img-fluid" alt="...">
                <div class="about-picture">
                  <h6 class="about-copyright text-warning">ESP32 Camera Slider Controller - version 0.1 - &copy; 2023
                    Carl
                    Tremblay</h6>
                </div>
              </div>
              <div class="card-body bg-darker">
                <p class="h5 text-primary">ESP32 Camera Slider Controller</p>
                <p class="h6 text-white-50 about">ESP32 Camera Slider Controller is a universal video / timelapse slider
                  control system compatible with virtually any camera sliders. It is designed by Carl Tremblay (aka
                  Cinosh07) with astrophotography timelapse and video production in mind. </p>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 
    **************************************************************
                              Footer -->
  <footer id="sticky-footer" class="card-footer fixed-bottom app-footer bg-darker text-white-50">
    <div class="container text-end app-footer-content">
      <div class="copyright-container">
        <smaller >Copyright &copy; Carl Tremblay - 2023</smaller>
      </div>
      
      <button class="btn btn-primary">NEXT</button>
    </div>
  </footer>
  <!-- 
    **************************************************************
                              Scripts
    **************************************************************
  -->
  <!-- 
    **************************************************************
                              Chart -->
  <script>
    const ctx = document.getElementById('myChart');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Start', 'Ease-in', '', '', '', 'Ease-out', 'Stop'],
        datasets: [{
          label: 'Speed',
          data: [0, 10, null, null, null, 10, 0],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        },
        spanGaps: true,
        tension: 0.5
      }
    });
  </script>
  <!-- 
    **************************************************************
                              Joystick -->
  <script>
    class JoystickController {
      // stickID: ID of HTML element (representing joystick) that will be dragged
      // maxDistance: maximum amount joystick can move in any direction
      // deadzone: joystick must move at least this amount from origin to register value change
      constructor(stickID, maxDistance, deadzone) {
        this.id = stickID;
        let stick = document.getElementById(stickID);

        // location from which drag begins, used to calculate offsets
        this.dragStart = null;

        // track touch identifier in case multiple joysticks present
        this.touchId = null;

        this.active = false;
        this.value = {
          x: 0,
          y: 0
        };

        let self = this;

        function handleDown(event) {
          self.active = true;

          // all drag movements are instantaneous
          stick.style.transition = '0s';

          // touch event fired before mouse event; prevent redundant mouse event from firing
          event.preventDefault();

          if (event.changedTouches)
            self.dragStart = {
              x: event.changedTouches[0].clientX,
              y: event.changedTouches[0].clientY
            };
          else
            self.dragStart = {
              x: event.clientX,
              y: event.clientY
            };

          // if this is a touch event, keep track of which one
          if (event.changedTouches)
            self.touchId = event.changedTouches[0].identifier;
        }

        function handleMove(event) {
          if (!self.active) return;

          // if this is a touch event, make sure it is the right one
          // also handle multiple simultaneous touchmove events
          let touchmoveId = null;
          if (event.changedTouches) {
            for (let i = 0; i < event.changedTouches.length; i++) {
              if (self.touchId == event.changedTouches[i].identifier) {
                touchmoveId = i;
                event.clientX = event.changedTouches[i].clientX;
                event.clientY = event.changedTouches[i].clientY;
              }
            }

            if (touchmoveId == null) return;
          }

          const xDiff = event.clientX - self.dragStart.x;
          const yDiff = event.clientY - self.dragStart.y;
          const angle = Math.atan2(yDiff, xDiff);
          const distance = Math.min(maxDistance, Math.hypot(xDiff, yDiff));
          const xPosition = distance * Math.cos(angle);
          const yPosition = distance * Math.sin(angle);

          // move stick image to new position
          stick.style.transform = `translate3d(${xPosition}px, ${yPosition}px, 0px)`;

          // deadzone adjustment
          const distance2 = (distance < deadzone) ? 0 : maxDistance / (maxDistance - deadzone) * (distance -
            deadzone);
          const xPosition2 = distance2 * Math.cos(angle);
          const yPosition2 = distance2 * Math.sin(angle);
          const xPercent = parseFloat((xPosition2 / maxDistance).toFixed(4));
          const yPercent = parseFloat((yPosition2 / maxDistance).toFixed(4));

          self.value = {
            x: xPercent,
            y: yPercent
          };
        }

        function handleUp(event) {
          if (!self.active) return;

          // if this is a touch event, make sure it is the right one
          if (event.changedTouches && self.touchId != event.changedTouches[0].identifier) return;

          // transition the joystick position back to center
          stick.style.transition = '.2s';
          stick.style.transform = `translate3d(0px, 0px, 0px)`;

          // reset everything
          self.value = {
            x: 0,
            y: 0
          };
          self.touchId = null;
          self.active = false;
        }

        stick.addEventListener('mousedown', handleDown);
        stick.addEventListener('touchstart', handleDown);
        document.addEventListener('mousemove', handleMove, {
          passive: false
        });
        document.addEventListener('touchmove', handleMove, {
          passive: false
        });
        document.addEventListener('mouseup', handleUp);
        document.addEventListener('touchend', handleUp);
      }
    }

    let joystick1 = new JoystickController("stick1", 64, 8);
    let joystick2 = new JoystickController("stick2", 64, 8);

    function update() {
      // document.getElementById("status1").innerText = "Joystick 1: " + JSON.stringify(joystick1.value);
      // document.getElementById("status2").innerText = "Joystick 2: " + JSON.stringify(joystick2.value);
    }

    function loop() {
      requestAnimationFrame(loop);
      update();
    }

    loop();
  </script>
</body>

</html>